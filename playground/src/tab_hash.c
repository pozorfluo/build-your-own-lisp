#include <stdio.h>

size_t hash_tab(const unsigned char *key)
{
	static const size_t xor_table[] = {
	    27971, 29696, 1025,  26659, 62932, 5107,  35958, 44509, 34357, 7372,
	    12308, 36243, 62261, 65251, 39383, 10080, 28288, 11518, 1323,  44124,
	    52132, 23168, 3596,  31582, 8167,  36443, 11626, 18430, 30798, 43965,
	    59727, 1268,  28298, 35204, 51329, 27156, 58003, 29983, 8709,  47190,
	    60865, 53205, 51095, 62274, 14082, 12782, 62190, 39013, 15442, 30154,
	    30941, 2339,  42072, 39864, 45305, 52485, 49671, 19860, 55841, 28916,
	    35175, 2534,  35942, 28144, 23848, 29273, 59281, 9056,  30103, 60243,
	    25134, 22411, 13879, 57006, 12427, 32343, 4009,  37415, 45652, 51638,
	    18637, 8093,  11142, 7979,  34882, 59976, 42164, 59067, 8225,  53147,
	    13070, 29442, 10300, 51391, 16478, 27106, 7805,  54803, 55782, 64995,
	    17263, 27761, 25926, 48941, 3350,  3286,  44653, 27656, 8271,  45953,
	    10756, 39484, 64531, 6395,  8859,  62236, 23993, 28374, 40716, 44295,
	    43328, 36200, 18531, 6098,  1233,  4770,  2583,  6643,  10674, 36756,
	    11180, 25383, 34628, 59497, 48477, 47740, 60115, 17503, 28003, 10726,
	    57784, 29011, 22565, 32690, 35743, 16689, 4870,  21481, 3928,  59612,
	    51349, 30690, 23197, 33206, 55257, 44558, 16565, 51897, 17954, 28538,
	    2155,  60808, 13606, 34417, 2366,  34448, 16632, 9374,  48957, 50496,
	    41252, 26248, 52014, 53996, 5376,  61881, 51902, 50329, 46143, 51791,
	    24067, 37453, 32080, 41273, 45460, 63236, 42166, 18393, 40321, 55987,
	    62124, 57274, 29204, 10995, 5691,  12962, 15814, 174,   22691, 52354,
	    14838, 43033, 37401, 33756, 40194, 53728, 40672, 49446, 37287, 1115,
	    48396, 26441, 4633,  37936, 35133, 31609, 49588, 48314, 26113, 8879,
	    2437,  65176, 46792, 40390, 1328,  64648, 56361, 1794,  8309,  56310,
	    7282,  21274, 52611, 1793,  65286, 39254, 3863,  15019, 44753, 60445,
	    44700, 8710,  61930, 33656, 63895, 34451, 42755, 4603,  45978, 14290,
	    1180,  24418, 38082, 64862, 64087, 50749};

	size_t hash = 0;

	// while (*key) {
	// 	hash ^= xor_table[(*key + hash) & 0xFF] ^ *key;
	// 	printf(
	// 	    "partial hash : %lu\n"
	// 	    "char         : %c\n"
	// 	    "xor[char]    : %lu\n",
	// 	    hash,
	// 	    (char)*key,
	// 		xor_table[*key]);
	// 	key++;
	// }

	int i = 0;

	while (*key) {
		// hash ^= xor_table[*key + i] ^ *key;
		// hash ^= xor_table[(*key + i)& 0xFF] ^ *key;
		hash ^= xor_table[(unsigned char)(*key + hash)] ^ *key;
		printf(
		    "partial hash  : %lu\n"
		    "char          : %c\n"
		    "xor[char]     : %lu\n"
			"rolling index : %d\n\n",
		    hash,
		    (char)*key,
		    xor_table[*key],
			(unsigned char)(*key + hash));
		key++;
		i++;
	}

	return hash;
}

size_t hash_tab_iroll(const unsigned char *key)
{
	static const size_t xor_table[] = {
	    27971, 29696, 1025,  26659, 62932, 5107,  35958, 44509, 34357, 7372,
	    12308, 36243, 62261, 65251, 39383, 10080, 28288, 11518, 1323,  44124,
	    52132, 23168, 3596,  31582, 8167,  36443, 11626, 18430, 30798, 43965,
	    59727, 1268,  28298, 35204, 51329, 27156, 58003, 29983, 8709,  47190,
	    60865, 53205, 51095, 62274, 14082, 12782, 62190, 39013, 15442, 30154,
	    30941, 2339,  42072, 39864, 45305, 52485, 49671, 19860, 55841, 28916,
	    35175, 2534,  35942, 28144, 23848, 29273, 59281, 9056,  30103, 60243,
	    25134, 22411, 13879, 57006, 12427, 32343, 4009,  37415, 45652, 51638,
	    18637, 8093,  11142, 7979,  34882, 59976, 42164, 59067, 8225,  53147,
	    13070, 29442, 10300, 51391, 16478, 27106, 7805,  54803, 55782, 64995,
	    17263, 27761, 25926, 48941, 3350,  3286,  44653, 27656, 8271,  45953,
	    10756, 39484, 64531, 6395,  8859,  62236, 23993, 28374, 40716, 44295,
	    43328, 36200, 18531, 6098,  1233,  4770,  2583,  6643,  10674, 36756,
	    11180, 25383, 34628, 59497, 48477, 47740, 60115, 17503, 28003, 10726,
	    57784, 29011, 22565, 32690, 35743, 16689, 4870,  21481, 3928,  59612,
	    51349, 30690, 23197, 33206, 55257, 44558, 16565, 51897, 17954, 28538,
	    2155,  60808, 13606, 34417, 2366,  34448, 16632, 9374,  48957, 50496,
	    41252, 26248, 52014, 53996, 5376,  61881, 51902, 50329, 46143, 51791,
	    24067, 37453, 32080, 41273, 45460, 63236, 42166, 18393, 40321, 55987,
	    62124, 57274, 29204, 10995, 5691,  12962, 15814, 174,   22691, 52354,
	    14838, 43033, 37401, 33756, 40194, 53728, 40672, 49446, 37287, 1115,
	    48396, 26441, 4633,  37936, 35133, 31609, 49588, 48314, 26113, 8879,
	    2437,  65176, 46792, 40390, 1328,  64648, 56361, 1794,  8309,  56310,
	    7282,  21274, 52611, 1793,  65286, 39254, 3863,  15019, 44753, 60445,
	    44700, 8710,  61930, 33656, 63895, 34451, 42755, 4603,  45978, 14290,
	    1180,  24418, 38082, 64862, 64087, 50749};

	size_t hash = 0;

	int i = xor_table[*key];
	// int i = 0;

	while (*key) {
		// hash ^= xor_table[*key + i] ^ *key;
		// hash ^= xor_table[(*key + i)& 0xFF] ^ *key;
		hash ^= (xor_table[*key] ^ *key) + i;
		i+=xor_table[i & 0xFF];
		printf(
		    "partial hash  : %lu\n"
		    "char          : %c\n"
		    "xor[char]     : %lu\n"
			"rolling index : %d\n\n",
		    hash,
		    (char)*key,
		    xor_table[*key],
			i);
		key++;
	}

	return hash;
}

//--------------------------------------------------------------------- MAIN ---
int main(void)
{

	char key[256];

	// unsigned char code[] = "abd\1\2\3";
	// printf("-> %lu\n\n", hash_tab((unsigned char *)"\xff"));
	// printf("-> %lu\n\n", hash_tab((unsigned char *)"\xff\xff"));
	// printf("-> %lu\n\n", hash_tab((unsigned char *)"\xff\xff\xff"));
	// printf("-> %lu\n\n", hash_tab((unsigned char *)"\xfe\xff"));
	// printf("-> %lu\n\n", hash_tab((unsigned char *)"\xfd\xfe\xff"));
	printf("-> %lu\n\n", hash_tab((unsigned char *)"\xff\xfe"));
	// printf("-> %lu\n\n", hash_tab((unsigned char *)"\xaa\xab"));
	printf("-> %lu\n\n", hash_tab((unsigned char *)"\xab\xaa"));
	printf("-> %lu\n\n", hash_tab((unsigned char *)"\xab\xaa\xa9"));
	printf("-> %lu\n\n", hash_tab((unsigned char *)"\xab\xaa\xa9\xa8"));
	printf("-> %lu\n\n", hash_tab((unsigned char *)"\xac\xab"));
	for (;;) {

		fputs("\x1b[102m > \x1b[0m", stdout);
		// fgets(key, 255, stdin);
		scanf("%s", key);

		// if ((strcmp(key, "exit")) == 0) {
		// 	break;
		// }
		// scanf("%s", key);
		printf("%lu\n", hash_tab((unsigned char *)key));
	}

	return 0;
}
